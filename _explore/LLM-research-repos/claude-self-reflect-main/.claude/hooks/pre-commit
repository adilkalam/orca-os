#!/bin/bash
# Pre-commit hook for Claude Self-Reflect
# Updates quality status cache before commits

# Get the directory of this script
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/../.." && pwd)"

# Update quality cache for current project
PROJECT_NAME=$(basename "$PWD")

# Run AST-GREP analysis and update cache
echo "ðŸ” Updating code quality status..."
python3 "$PROJECT_ROOT/scripts/session_quality_tracker.py" 2>/dev/null

# Update the project cache
python3 "$PROJECT_ROOT/scripts/update-quality-all-projects.py" --project "$PROJECT_NAME" 2>/dev/null

# Always allow commit to proceed
exit 0